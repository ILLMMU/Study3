---
title             : "The title"
shorttitle        : "Title"

author: 
  - name          : "Mushfiqul Anwar Siraji"
    affiliation   : "1"
    email         : "mushfiqul.anwarsiraji@monash.edu"
    role:         
      - Conceptualization
      - Data curation
      - Investigation
      - Project administration
      - Methodology
      - Formal Analysis
      - Visualization
      - Writing - Original Draft Preparation
      - Writing - Review & Editing
  - name          : "Yi Jiau Saw"
    affiliation   : "2"
    email         : "mushfiqul.anwarsiraji@monash.edu"
    role:         
      - Conceptualization
      - Investigation
      - Data curation
      - Writing - Review & Editing
  - name          : "Vineetha Kalavally"
    affiliation   : "2"
    role:
      - Conceptualization
      - Project administration
      - Methodology
      - Writing – original draft
      - Writing – review & editing
  - name          : "Shamsul Haque"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Postal address"
    email         : "email"
    role:
      - Conceptualization
      - Project administration
      - Methodology
      - Writing – original draft
      - Writing – review & editing

affiliation:
  - id            : "1"
    institution   : "Monash University, Department of Psychology, Jeffrey Cheah School of Medicine and Health Sciences, Malaysia"
  - id            : "2"
    institution   : "Monash University, Department of Electrical and Computer Systems Engineering, Malaysia, Selangor, Malaysia"

authornote: |
  Add complete departmental affiliations for each author here. Each new line herein must be indented, like this line.

  Enter author note here.

abstract: |
  One or two sentences providing a **basic introduction** to the field,  comprehensible to a scientist in any discipline.
  
  Two to three sentences of **more detailed background**, comprehensible  to scientists in related disciplines.
  
  One sentence clearly stating the **general problem** being addressed by  this particular study.
  
  One sentence summarizing the main result (with the words "**here we show**" or their equivalent).
  
  Two or three sentences explaining what the **main result** reveals in direct comparison to what was thought to be the case previously, or how the  main result adds to previous knowledge.
  
  One or two sentences to put the results into a more **general context**.
  
  Two or three sentences to provide a **broader perspective**, readily comprehensible to a scientist in any discipline.
  

  
keywords          : "keywords"
wordcount         : "X"

bibliography      : ["r-references.bib", "library.bib"]

floatsintext      : no
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : yes
mask              : no
draft             : no


documentclass     : "apa6"
classoption       : "man"
output            : 
  papaja::apa6_docx:
    
mainfont: Arial
---


```{r setup, warning=FALSE, include=FALSE}
#This chunk controls the common chunk parameters for the whole manuscript
knitr::opts_chunk$set(echo = FALSE, warning = F, message = F, dpi=300, fig.width = 6,
 fig.asp = 0.8,out.width = "80%", dev=c('png','postscript'))
#options(knitr.duplicate.label = "allow")
set.seed(2022)
par(family = "Arial")
```

```{r library, include = FALSE}
library(papaja) # devtools::install_github("crsh/papaja")
library(MOTE)
library(psych)
library(tidyverse)
library(readr)
library(ggsci)
library(ggtext)
library(ggpubr)
library(WRS2)
library(gtsummary)
library(gt)
library(readxl)
library(glue)
library(ggtext)
library(kableExtra)
library(tabledown)
# renv::snapshot()
r_refs("library.bib")
```

```{r ggplot2, include=F}
#This chunk holds code for creating ggplot2 based apatheme for plots.
apatheme=theme_bw()+
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank(),
        axis.text.x = element_text(size = 12),
        axis.text.y = element_text(size = 12),
        axis.title.x = element_text(size = 12),
        axis.title.y = element_text(size = 12),
        plot.title = element_text(size = 12),
        legend.text = element_text(size =12),
        legend.title=element_blank(),
        axis.line.x = element_line(color='black'),
        axis.line.y = element_line(color='black'),
        panel.border = element_rect(color = "black",
                                    fill = NA,
                                    size = 1))
```

```{r light-spectrum-curve}
ls <- read_csv("Processeddata/Luox output/SPD_80_cm_horizontal_luox_out_SPD.csv")
ls.2 <- ls %>%
    pivot_longer(cols = 2:4,
               names_to = "Condition",
               values_to = ("value"))
ls.3 <- ls.2
ls.3$Condition <- as.factor(ls.3$Condition)
ls.3$value <- ls.3$value *100

## Reordering ls.3$Condition
ls.3$Condition <- ls.3$Condition %>%
  fct_relevel(
     "High MDER","Neutral MDER","Low MDER",
  )

spectrum <- ggplot(ls.3, aes(x= Wavelength, y= value, color = Condition))+ geom_line()+apatheme+
  xlab("Wavelength(nm)")+scale_x_continuous(breaks=c(380, 420, 460, 500, 540, 580, 620, 660, 700, 740, 780), limits = c(380,780))+theme(legend.position = "bottom")+
  ylab(expression("Spectral irradiance" (μW/cm^2/nm)))+
  scale_color_manual(values=c('blue',"#7E6148B2", "#DC0000B2"))+
  theme(axis.title.x = element_text(size = 14),
        axis.title.y = element_text(size = 14))




ggsave("Figures/spectrum.png",spectrum, width=5, height=4)

```


```{r plot-legends}
Low <- "Low"
Neutral <- "Neutral"
High <- "High"


Low_color <- "#DC0000B2"
Neutral_color <- "#7E6148B2"
High_color <- "blue"

```


```{r outlier-formula,include=FALSE}
#This chunk hold the formula to identify and adjest outliers
outadj <- function(x, y){
Q <- quantile(y, probs=c(.25, .75), na.rm = T)
iqr <- IQR(y)
up <-  Q[2]+1.5*iqr # Upper Range  
low<- Q[1]-1.5*iqr # Lower Range
eliminated<- subset(x, y > (Q[1] - 1.5*iqr) & y < (Q[2]+1.5*iqr))
eliminated
}
```


```{r data}
data <- read_excel("Processeddata/Study_2_Full_data_N_24.xlsx")
light_indices <- read_csv("Processeddata/alpha_opic_indices_data.csv")



light_indices_summary <- light_indices %>% 
  group_by(Group) %>% 
  summarise(mean_photopic = mean(`Photopic lx`),
            sd_photopic = sd(`Photopic lx`))


```



# Methods



## Participants

```{r prepareDescTable, include=FALSE}
#This chunk holds code for demographic data wrangling.

demographics <-   data %>% 
  dplyr::select(Light_Settings, Age, Gender,marital_status, eductation, Sleep_qlty,  Chronotype_category)

demographics$Age <- as.numeric(demographics$Age)

# create descriptive table for the demographic vars (excluding tz & Country) with gtsummary
 desc_table <- demographics %>%
  tbl_summary(
    by = Light_Settings,
    statistic = list(all_continuous() ~ "{mean} ({sd})",
                     all_categorical() ~ "{n} ({p}%)"),
    type =list(Age~ 'continuous'), 
                     
    digits = all_continuous() ~ 2,
    label = list(Age ~ "Age",
                 Gender ~ "Gender",
                eductation ~ "Education",
                 marital_status ~ "Marital Status",
                 Sleep_qlty ~ "Sleep Quality",
                 Chronotype_category~ "Chronotype"
                 ),
    
    missing = "no"
    ) %>% add_overall() %>% bold_labels() %>% 
  # add_p() %>% add_q() %>%
modify_header(label ~ "**Variable**") %>% 
  # separate_p_footnotes() %>%
  modify_caption("Demographic Characteristics of Participants (n=15).") 


desc_kable <- as_hux_table(desc_table)  #save it as a knitr::kable

desc_tibble <- as.tibble(desc_table)


description_group <- psych::describe.by(demographics,  "Light_Settings")

description <- psych::describe(demographics)
description_gender <- psych::describe.by(demographics,  "Gender")

```



```{r demotab, warning=F, message=F}
apa_table(desc_kable)

```


## Light Exposure Conditions


## Study Protocol


## Data analysis



# Results

## Alerting effects




```{r Kss-anova}

KSS <- data %>% 
  dplyr::select ("Light_Settings", "KSS_DIF")


KSS_summary <- KSS %>% 
  group_by(Light_Settings) %>% 
  summarise(Mean=mean(KSS_DIF),
            SD= sd(KSS_DIF),
            n = n(),
            SEM = SD / sqrt(n))


kss_anova_model <- aov(KSS_DIF ~ Light_Settings, data = KSS)

Kss_summary <- summary(kss_anova_model)

effectsize::effectsize(kss_anova_model)

TukeyHSD(kss_anova_model, data = KSS)

pairwise.t.test(KSS$KSS_DIF, KSS$Light_Settings, p.adj='bonferroni')

```

```{r kss-anova-plot,include=FALSE}
metadata_kss <- KSS %>%
  mutate(Condition = factor(Light_Settings,
                               levels=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"
                                        )))



kss_plot <- metadata_kss %>%
  ggplot(aes(x= Light_Settings, y = KSS_DIF, fill = Light_Settings)) +
  # geom_boxplot(show.legend = FALSE)+
  stat_summary(fun.data = mean_se, geom = "errorbar", width =0.5)+
  stat_summary(fun.data = mean_se, geom = "bar", show.legend = FALSE,width = .5, alpha=1)+
  # geom_jitter(show.legend=FALSE, width=0.25, shape=21, color="black") +
  labs(x=NULL,
       y="Subjective Sleepiness (\u0394 KSS)")+
  scale_x_discrete(breaks=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
                   labels=c(Low, Neutral, High))+
  scale_fill_manual(name=NULL,
                    breaks=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
                    labels=c(Low, Neutral, High),
                    values=c(Low_color, Neutral_color, High_color)) +
  apatheme +
  theme(axis.text.x = element_markdown())
  # scale_y_continuous(expand = expansion(mult = c(0, .1)), breaks= c(-2,-1,0,1,2,3))+
  geom_hline(yintercept=0)


lines <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_lines = c(1,1,2),
  xend_lines = c(1.95,3,3),
  y_lines = c(2, 2.5, 2),
  yend_lines = y_lines
  
)


vlines_left <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_vlines_left = lines$x_lines,
  xend_vlines_left = lines$x_lines,
  y_vlines_left = lines$y_lines-0.05,
  yend_vlines_left = lines$y_lines
  
)

vlines_right <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_vlines_right  = lines$xend_lines,
  xend_vlines_right = lines$xend_lines,
  y_vlines_right = vlines_left$y_vlines_left,
  yend_vlines_right = lines$y_lines
  
)

stars <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  
  x = c(1.5,2, 2.5),
  
  y = lines$y_lines+.2,
  label =c("n.s",  "*", "*")
)


anova_kss_plot <- kss_plot +
  geom_segment(data=lines, aes(x =x_lines, xend =xend_lines, y=y_lines, yend=yend_lines), inherit.aes = F)+
  geom_segment(data=vlines_left, aes(x =x_vlines_left, xend =xend_vlines_left, y=y_vlines_left, yend=yend_vlines_left), inherit.aes = F)+
  geom_segment(data=vlines_right, aes(x =x_vlines_right, xend =xend_vlines_right, y=y_vlines_right, yend=yend_vlines_right), inherit.aes = F)+
geom_text(data =stars, aes(x=x, y=y, label =label), inherit.aes = F,size = 5) 

# ggsave("Figures/Figure7.png", width=9, height=7)

# ggsave("Figures/anova_pvt_miss.png", width=4.5, height=3.5)

```

```{r PVT}
pvt_raw <- read_excel("Processeddata/aPVT_RT_2.xlsx")

pvt_raw.numeric <- pvt_raw[,-1]
pvt_raw.base <- pvt_raw[,1]
pvt_raw.conversion <- as.data.frame(lapply(pvt_raw.numeric, function(x) x*1000 ))


pvt_data <- cbind(pvt_raw.base,pvt_raw.conversion)

pvt_long <- pivot_longer(pvt_data,
                              cols=-1,
                              names_to="Trials",
                              values_to = "RT")



#P001


P001_pvt_data <- pvt_long  %>%
  filter(Id=="P001")


#P002

P002_pvt_data <- pvt_long  %>%
  filter(Id=="P002")

#P003

P003_pvt_data <- pvt_long  %>%
  filter(Id=="P003")

#P004
P004_pvt_data <- pvt_long  %>%
  filter(Id=="P004")
#P005
P005_pvt_data <- pvt_long  %>%
  filter(Id=="P005")
#P006
P006_pvt_data <- pvt_long  %>%
  filter(Id=="P006")
#P007
P007_pvt_data <- pvt_long  %>%
  filter(Id=="P007")

#P008
P008_pvt_data <- pvt_long  %>%
  filter(Id=="P008")

#P009
P009_pvt_data <- pvt_long  %>%
  filter(Id=="P009")

#P010
P010_pvt_data <- pvt_long  %>%
  filter(Id=="P010")

#P011
P011_pvt_data <- pvt_long  %>%
  filter(Id=="P011")

#P013

P013_pvt_data <- pvt_long  %>%
  filter(Id=="P013")

#P014
P014_pvt_data <- pvt_long  %>%
  filter(Id=="P014")

#P015
P015_pvt_data <- pvt_long  %>%
  filter(Id=="P015")

#P016

P016_pvt_data <- pvt_long  %>%
  filter(Id=="P016")

#P017
P017_pvt_data <- pvt_long  %>%
  filter(Id=="P017")


#P018

P018_pvt_data <- pvt_long  %>%
  filter(Id=="P018")
#P019

P019_pvt_data <- pvt_long  %>%
  filter(Id=="P019")

#P020
P020_pvt_data <- pvt_long  %>%
  filter(Id=="P020")

#P021

P021_pvt_data <- pvt_long  %>%
  filter(Id=="P021")
#P022

P022_pvt_data <- pvt_long  %>%
  filter(Id=="P022")


#P023

P023_pvt_data <- pvt_long  %>%
  filter(Id=="P023")

#P024
P024_pvt_data <- pvt_long  %>%
  filter(Id=="P024")


#P025

P025_pvt_data <- pvt_long  %>%
  filter(Id=="P025")





#P001

P001_pvt_plot <- ggplot(P001_pvt_data , aes(x=Trials, y=RT))+
  geom_col()+
  scale_y_continuous(expand = expansion(mult = c(0, .1)))+
  geom_hline(yintercept = 500, color="red")+theme_bw()+
  geom_hline(yintercept = 100, color="green")+
  theme(axis.text.x = element_text(angle = 90))+labs(title = "P001")+
  theme(axis.text.x = element_text(size = 6))+
  labs(x="Trial", y="RT (ms)")


ggsave("Figures/apvt/P001_pvt_plot.png",P001_pvt_plot, width = 8, height = 3.5,
       dpi = 300, bg = "white", units = "in")

#P002

P002_pvt_plot <- ggplot(P002_pvt_data , aes(x=Trials, y=RT))+
  geom_col()+
  scale_y_continuous(expand = expansion(mult = c(0, .1)))+
  geom_hline(yintercept = 500, color="red")+theme_bw()+
  geom_hline(yintercept = 100, color="green")+
  theme(axis.text.x = element_text(angle = 90))+labs(title = "P002")+
  theme(axis.text.x = element_text(size = 6))+
  labs(x="Trial", y="RT (ms)")

ggsave("Figures/apvt/P002_pvt_plot.png",P002_pvt_plot, width = 8, height = 3.5,
       dpi = 300, bg = "white", units = "in")

#P003

P003_pvt_plot <- ggplot(P003_pvt_data , aes(x=Trials, y=RT))+
  geom_col()+
  scale_y_continuous(expand = expansion(mult = c(0, .1)))+
  geom_hline(yintercept = 500, color="red")+theme_bw()+
  geom_hline(yintercept = 100, color="green")+
  theme(axis.text.x = element_text(angle = 90))+labs(title = "P003")+
  theme(axis.text.x = element_text(size = 6))+
  labs(x="Trial", y="RT (ms)")

ggsave("Figures/apvt/P003_pvt_plot.png",P003_pvt_plot, width = 8, height = 3.5,
       dpi = 300, bg = "white", units = "in")

#P004
P004_pvt_plot <- ggplot(P004_pvt_data , aes(x=Trials, y=RT))+
  geom_col()+
  scale_y_continuous(expand = expansion(mult = c(0, .1)))+
  geom_hline(yintercept = 500, color="red")+theme_bw()+
  geom_hline(yintercept = 100, color="green")+
  theme(axis.text.x = element_text(angle = 90))+labs(title = "P004")+
  theme(axis.text.x = element_text(size = 6))+
  labs(x="Trial", y="RT (ms)")

ggsave("Figures/apvt/P004_pvt_plot.png",P004_pvt_plot, width = 8, height = 3.5,
       dpi = 300, bg = "white", units = "in")

#P005
P005_pvt_plot <- ggplot(P005_pvt_data , aes(x=Trials, y=RT))+
  geom_col()+
  scale_y_continuous(expand = expansion(mult = c(0, .1)))+
  geom_hline(yintercept = 500, color="red")+theme_bw()+
  geom_hline(yintercept = 100, color="green")+
  theme(axis.text.x = element_text(angle = 90))+labs(title = "P005")+
  theme(axis.text.x = element_text(size = 6))+
  labs(x="Trial", y="RT (ms)")

ggsave("Figures/apvt/P005_pvt_plot.png",P005_pvt_plot, width = 8, height = 3.5,
       dpi = 300, bg = "white", units = "in")

#P006
P006_pvt_plot <- ggplot(P006_pvt_data , aes(x=Trials, y=RT))+
  geom_col()+
  scale_y_continuous(expand = expansion(mult = c(0, .1)))+
  geom_hline(yintercept = 500, color="red")+theme_bw()+
  geom_hline(yintercept = 100, color="green")+
  theme(axis.text.x = element_text(angle = 90))+labs(title = "P006")+
  theme(axis.text.x = element_text(size = 6))+
  labs(x="Trial", y="RT (ms)")

ggsave("Figures/apvt/P006_pvt_plot.png",P006_pvt_plot, width = 8, height = 3.5,
       dpi = 300, bg = "white", units = "in")

#P007
P007_pvt_plot <- ggplot(P007_pvt_data , aes(x=Trials, y=RT))+
  geom_col()+
  scale_y_continuous(expand = expansion(mult = c(0, .1)))+
  geom_hline(yintercept = 500, color="red")+theme_bw()+
  geom_hline(yintercept = 100, color="green")+
  theme(axis.text.x = element_text(angle = 90))+labs(title = "P007")+
  theme(axis.text.x = element_text(size = 6))+
  labs(x="Trial", y="RT (ms)")

ggsave("Figures/apvt/P007_pvt_plot.png",P007_pvt_plot, width = 8, height = 3.5,
       dpi = 300, bg = "white", units = "in")


#P008
P008_pvt_plot <- ggplot(P008_pvt_data , aes(x=Trials, y=RT))+
  geom_col()+
  scale_y_continuous(expand = expansion(mult = c(0, .1)))+
  geom_hline(yintercept = 500, color="red")+theme_bw()+
  geom_hline(yintercept = 100, color="green")+
  theme(axis.text.x = element_text(angle = 90))+labs(title = "P008")+
  theme(axis.text.x = element_text(size = 6))+
  labs(x="Trial", y="RT (ms)")

ggsave("Figures/apvt/P008_pvt_plot.png",P008_pvt_plot, width = 8, height = 3.5,
       dpi = 300, bg = "white", units = "in")


#P009
P009_pvt_plot <- ggplot(P009_pvt_data , aes(x=Trials, y=RT))+
  geom_col()+
  scale_y_continuous(expand = expansion(mult = c(0, .1)))+
  geom_hline(yintercept = 500, color="red")+theme_bw()+
  geom_hline(yintercept = 100, color="green")+
  theme(axis.text.x = element_text(angle = 90))+labs(title = "P009")+
  theme(axis.text.x = element_text(size = 6))+
  labs(x="Trial", y="RT (ms)")

ggsave("Figures/apvt/P009_pvt_plot.png",P009_pvt_plot, width = 8, height = 3.5,
       dpi = 300, bg = "white", units = "in")



#P010
P010_pvt_plot <- ggplot(P010_pvt_data , aes(x=Trials, y=RT))+
  geom_col()+
  scale_y_continuous(expand = expansion(mult = c(0, .1)))+
  geom_hline(yintercept = 500, color="red")+theme_bw()+
  geom_hline(yintercept = 100, color="green")+
  theme(axis.text.x = element_text(angle = 90))+labs(title = "P010")+
  theme(axis.text.x = element_text(size = 6))+
  labs(x="Trial", y="RT (ms)")

ggsave("Figures/apvt/P010_pvt_plot.png",P010_pvt_plot, width = 8, height = 3.5,
       dpi = 300, bg = "white", units = "in")


#P011
P011_pvt_plot <- ggplot(P011_pvt_data , aes(x=Trials, y=RT))+
  geom_col()+
  scale_y_continuous(expand = expansion(mult = c(0, .1)))+
  geom_hline(yintercept = 500, color="red")+theme_bw()+
  geom_hline(yintercept = 100, color="green")+
  theme(axis.text.x = element_text(angle = 90))+labs(title = "P011")+
  theme(axis.text.x = element_text(size = 6))+
  labs(x="Trial", y="RT (ms)")

ggsave("Figures/apvt/P011_pvt_plot.png",P011_pvt_plot, width = 8, height = 3.5,
       dpi = 300, bg = "white", units = "in")

#P013

P013_pvt_plot <- ggplot(P013_pvt_data , aes(x=Trials, y=RT))+
  geom_col()+
  scale_y_continuous(expand = expansion(mult = c(0, .1)))+
  geom_hline(yintercept = 500, color="red")+theme_bw()+
  geom_hline(yintercept = 100, color="green")+
  theme(axis.text.x = element_text(angle = 90))+labs(title = "P013")+
  theme(axis.text.x = element_text(size = 6))+
  labs(x="Trial", y="RT (ms)")

ggsave("Figures/apvt/P013_pvt_plot.png",P013_pvt_plot, width = 8, height = 3.5,
       dpi = 300, bg = "white", units = "in")


#P014
P014_pvt_plot <- ggplot(P014_pvt_data , aes(x=Trials, y=RT))+
  geom_col()+
  scale_y_continuous(expand = expansion(mult = c(0, .1)))+
  geom_hline(yintercept = 500, color="red")+theme_bw()+
  geom_hline(yintercept = 100, color="green")+
  theme(axis.text.x = element_text(angle = 90))+labs(title = "P014")+
  theme(axis.text.x = element_text(size = 6))+
  labs(x="Trial", y="RT (ms)")

ggsave("Figures/apvt/P014_pvt_plot.png",P014_pvt_plot, width = 8, height = 3.5,
       dpi = 300, bg = "white", units = "in")


#P015
P015_pvt_plot <- ggplot(P015_pvt_data , aes(x=Trials, y=RT))+
  geom_col()+
  scale_y_continuous(expand = expansion(mult = c(0, .1)))+
  geom_hline(yintercept = 500, color="red")+theme_bw()+
  geom_hline(yintercept = 100, color="green")+
  theme(axis.text.x = element_text(angle = 90))+labs(title = "P015")+
  theme(axis.text.x = element_text(size = 6))+
  labs(x="Trial", y="RT (ms)")

ggsave("Figures/apvt/P015_pvt_plot.png",P015_pvt_plot, width = 8, height = 3.5,
       dpi = 300, bg = "white", units = "in")


#P016

P016_pvt_plot <- ggplot(P016_pvt_data , aes(x=Trials, y=RT))+
  geom_col()+
  scale_y_continuous(expand = expansion(mult = c(0, .1)))+
  geom_hline(yintercept = 500, color="red")+theme_bw()+
  geom_hline(yintercept = 100, color="green")+
  theme(axis.text.x = element_text(angle = 90))+labs(title = "P016")+
  theme(axis.text.x = element_text(size = 6))+
  labs(x="Trial", y="RT (ms)")

ggsave("Figures/apvt/P016_pvt_plot.png",P016_pvt_plot, width = 8, height = 3.5,
       dpi = 300, bg = "white", units = "in")


#P017
P017_pvt_plot <- ggplot(P017_pvt_data , aes(x=Trials, y=RT))+
  geom_col()+
  scale_y_continuous(expand = expansion(mult = c(0, .1)))+
  geom_hline(yintercept = 500, color="red")+theme_bw()+
  geom_hline(yintercept = 100, color="green")+
  theme(axis.text.x = element_text(angle = 90))+labs(title = "P017")+
  theme(axis.text.x = element_text(size = 6))+
  labs(x="Trial", y="RT (ms)")

ggsave("Figures/apvt/P017_pvt_plot.png",P017_pvt_plot, width = 8, height = 3.5,
       dpi = 300, bg = "white", units = "in")


#P018
P018_pvt_plot <- ggplot(P018_pvt_data , aes(x=Trials, y=RT))+
  geom_col()+
  scale_y_continuous(expand = expansion(mult = c(0, .1)))+
  geom_hline(yintercept = 500, color="red")+theme_bw()+
  geom_hline(yintercept = 100, color="green")+
  theme(axis.text.x = element_text(angle = 90))+labs(title = "P018")+
  theme(axis.text.x = element_text(size = 6))+
  labs(x="Trial", y="RT (ms)")

ggsave("Figures/apvt/P018_pvt_plot.png",P018_pvt_plot, width = 8, height = 3.5,
       dpi = 300, bg = "white", units = "in")

#P019
P019_pvt_plot <- ggplot(P019_pvt_data , aes(x=Trials, y=RT))+
  geom_col()+
  scale_y_continuous(expand = expansion(mult = c(0, .1)))+
  geom_hline(yintercept = 500, color="red")+theme_bw()+
  geom_hline(yintercept = 100, color="green")+
  theme(axis.text.x = element_text(angle = 90))+labs(title = "P019")+
  theme(axis.text.x = element_text(size = 6))+
  labs(x="Trial", y="RT (ms)")

ggsave("Figures/apvt/P019_pvt_plot.png",P019_pvt_plot, width = 8, height = 3.5,
       dpi = 300, bg = "white", units = "in")


#P020
P020_pvt_plot <- ggplot(P020_pvt_data , aes(x=Trials, y=RT))+
  geom_col()+
  scale_y_continuous(expand = expansion(mult = c(0, .1)))+
  geom_hline(yintercept = 500, color="red")+theme_bw()+
  geom_hline(yintercept = 100, color="green")+
  theme(axis.text.x = element_text(angle = 90))+labs(title = "P020")+
  theme(axis.text.x = element_text(size = 6))+
  labs(x="Trial", y="RT (ms)")
ggsave("Figures/apvt/P020_pvt_plot.png",P020_pvt_plot, width = 8, height = 3.5,
       dpi = 300, bg = "white", units = "in")


#P021

P021_pvt_plot <- ggplot(P021_pvt_data , aes(x=Trials, y=RT))+
  geom_col()+
  scale_y_continuous(expand = expansion(mult = c(0, .1)))+
  geom_hline(yintercept = 500, color="red")+theme_bw()+
  geom_hline(yintercept = 100, color="green")+
  theme(axis.text.x = element_text(angle = 90))+labs(title = "P021")+
  theme(axis.text.x = element_text(size = 6))+
  labs(x="Trial", y="RT (ms)")

ggsave("Figures/apvt/P021_pvt_plot.png",P021_pvt_plot, width = 8, height = 3.5,
       dpi = 300, bg = "white", units = "in")

#P022
P022_pvt_plot <- ggplot(P022_pvt_data , aes(x=Trials, y=RT))+
  geom_col()+
  scale_y_continuous(expand = expansion(mult = c(0, .1)))+
  geom_hline(yintercept = 500, color="red")+theme_bw()+
  geom_hline(yintercept = 100, color="green")+
  theme(axis.text.x = element_text(angle = 90))+labs(title = "P022")+
  theme(axis.text.x = element_text(size = 6))+
  labs(x="Trial", y="RT (ms)")

ggsave("Figures/apvt/P022_pvt_plot.png",P022_pvt_plot, width = 8, height = 3.5,
       dpi = 300, bg = "white", units = "in")

#P023
P023_pvt_plot <- ggplot(P023_pvt_data , aes(x=Trials, y=RT))+
  geom_col()+
  scale_y_continuous(expand = expansion(mult = c(0, .1)))+
  geom_hline(yintercept = 500, color="red")+theme_bw()+
  geom_hline(yintercept = 100, color="green")+
  theme(axis.text.x = element_text(angle = 90))+labs(title = "P023")+
  theme(axis.text.x = element_text(size = 6))+
  labs(x="Trial", y="RT (ms)")

ggsave("Figures/apvt/P023_pvt_plot.png",P023_pvt_plot, width = 8, height = 3.5,
       dpi = 300, bg = "white", units = "in")

#P024
P024_pvt_plot <- ggplot(P024_pvt_data , aes(x=Trials, y=RT))+
  geom_col()+
  scale_y_continuous(expand = expansion(mult = c(0, .1)))+
  geom_hline(yintercept = 500, color="red")+theme_bw()+
  geom_hline(yintercept = 100, color="green")+
  theme(axis.text.x = element_text(angle = 90))+labs(title = "P024")+
  theme(axis.text.x = element_text(size = 6))+
  labs(x="Trial", y="RT (ms)")

ggsave("Figures/apvt/P024_pvt_plot.png",P024_pvt_plot, width = 8, height = 3.5,
       dpi = 300, bg = "white", units = "in")

#P025

P025_pvt_plot <- ggplot(P025_pvt_data , aes(x=Trials, y=RT))+
  geom_col()+
  scale_y_continuous(expand = expansion(mult = c(0, .1)))+
  geom_hline(yintercept = 500, color="red")+theme_bw()+
  geom_hline(yintercept = 100, color="green")+
  theme(axis.text.x = element_text(angle = 90))+labs(title = "P025")+
  theme(axis.text.x = element_text(size = 6))+
  labs(x="Trial", y="RT (ms)")

ggsave("Figures/apvt/P025_pvt_plot.png",P025_pvt_plot, width = 8, height = 3.5,
       dpi = 300, bg = "white", units = "in")







p1_mean <- mean(P001_pvt_data$RT)
p2_mean <- mean(P002_pvt_data$RT)
p3_mean <- mean(P003_pvt_data$RT)
p4_mean <- mean(P004_pvt_data$RT)
p5_mean <- mean(P005_pvt_data$RT)
p6_mean <- mean(P006_pvt_data$RT)
p7_mean <- mean(P007_pvt_data$RT)
p8_mean <- mean(P008_pvt_data$RT)
p9_mean <- mean(P009_pvt_data$RT)
p10_mean <- mean(P010_pvt_data$RT)
p11_mean <- mean(P011_pvt_data$RT)
p12_mean <- mean(P023_pvt_data$RT)
p14_mean <- mean(P014_pvt_data$RT)
p15_mean <- mean(P015_pvt_data$RT)
p16_mean <- mean(P016_pvt_data$RT)
p17_mean <- mean(P017_pvt_data$RT)
p18_mean <- mean(P018_pvt_data$RT)
p19_mean <- mean(P019_pvt_data$RT)
p20_mean <- mean(P020_pvt_data$RT)
p21_mean <- mean(P021_pvt_data$RT)
p22_mean <- mean(P022_pvt_data$RT)
p23_mean <- mean(P023_pvt_data$RT)
p24_mean <- mean(P024_pvt_data$RT)
p25_mean <- mean(P025_pvt_data$RT)


rt <- rbind(p1_mean,p2_mean,p3_mean,p4_mean,p5_mean,p6_mean,p7_mean,p8_mean,p9_mean,p10_mean,p11_mean,p12_mean,p14_mean,p15_mean,p16_mean,p17_mean,p18_mean,p19_mean,p20_mean,p21_mean,p22_mean,p23_mean,p24_mean,p25_mean)


rt_data <- as.data.frame(cbind(data$light_conditions,rt))
colnames(rt_data) <- c("Light_Settings", "RT")


rt_data$RT <- as.numeric(rt_data$RT)
rt_data$Light_Settings <- as.factor(rt_data$Light_Settings)
apvt_rt_model <- aov(1/RT ~ Light_Settings, data = rt_data)
apvt_rt_anova_summary <- summary(apvt_rt_model )

effectsize::effectsize(apvt_rt_model )

TukeyHSD(apvt_rt_model , data = rt_data)


aPVT_summary <-rt_data %>% 
  group_by(Light_Settings) %>% 
  summarise(Mean_rt=mean(RT),
            SEM_rt = sd(RT) / sqrt(n()))



#P001
P001_miss <- nrow(P001_pvt_data[P001_pvt_data$RT>500, ])

#P002
P002_miss <- nrow(P002_pvt_data[P002_pvt_data$RT>500, ])

#P003
P003_miss <- nrow(P003_pvt_data[P003_pvt_data$RT>500, ])
#P004
P004_miss <- nrow(P004_pvt_data[P004_pvt_data$RT>500, ])

#P005
P005_miss <- nrow(P005_pvt_data[P005_pvt_data$RT>500, ])

#P006
P006_miss <- nrow(P006_pvt_data[P006_pvt_data$RT>500, ])

#P007
P007_miss <- nrow(P007_pvt_data[P007_pvt_data$RT>500, ])


#P008
P008_miss <- nrow(P008_pvt_data[P008_pvt_data$RT>500, ])


#P009
P009_miss <- nrow(P009_pvt_data[P009_pvt_data$RT>500, ])


#P010
P010_miss <- nrow(P010_pvt_data[P010_pvt_data$RT>500, ])


#P011
P011_miss <- nrow(P011_pvt_data[P011_pvt_data$RT>500, ])


#P013
P013_miss <- nrow(P013_pvt_data[P013_pvt_data$RT>500, ])


#P014
P014_miss <- nrow(P014_pvt_data[P014_pvt_data$RT>500, ])


#P015
P015_miss <- nrow(P015_pvt_data[P015_pvt_data$RT>500, ])


#P016

P016_miss <- nrow(P016_pvt_data[P016_pvt_data$RT>500, ])


#P017
P017_miss <- nrow(P017_pvt_data[P017_pvt_data$RT>500, ])



#P018
P018_miss <- nrow(P018_pvt_data[P018_pvt_data$RT>500, ])

#P019

P019_miss <- nrow(P019_pvt_data[P019_pvt_data$RT>500, ])


#P020
P020_miss <- nrow(P020_pvt_data[P020_pvt_data$RT>500, ])


#P021

P021_miss <- nrow(P021_pvt_data[P021_pvt_data$RT>500, ])

#P022

P022_miss <- nrow(P022_pvt_data[P022_pvt_data$RT>500, ])



#P023

P023_miss <- nrow(P023_pvt_data[P023_pvt_data$RT>500, ])

#P024
P024_miss <- nrow(P024_pvt_data[P024_pvt_data$RT>500, ])



#P025

P025_miss <- nrow(P025_pvt_data[P025_pvt_data$RT>500, ])



#PVT Misses

pvt_miss <- rbind(P001_miss,P002_miss,P003_miss,P004_miss,P005_miss,P006_miss,P007_miss,
                  P008_miss,P009_miss,P010_miss,P011_miss,P013_miss,P014_miss,P015_miss,
                  P016_miss,P017_miss,P018_miss,P019_miss,P020_miss,P021_miss,P022_miss,
                  P023_miss,P024_miss,P025_miss)


miss_data <- as.data.frame(cbind(data$light_conditions,pvt_miss  ))
colnames(miss_data) <- c("Light_Settings", "Miss")




miss_transform <- sqrt(pvt_miss)+sqrt(pvt_miss+1)
miss_transform_data <- as.data.frame(cbind(data$light_conditions,miss_transform ))
colnames(miss_transform_data) <- c("Light_Settings", "Miss")

miss_transform_data$Miss <- as.numeric(miss_transform_data$Miss)

apvt_miss_model <- aov(Miss ~ Light_Settings, data = miss_transform_data)
apvt_miss_anova_summary <- summary(apvt_miss_model )
effectsize::effectsize(apvt_miss_model)
TukeyHSD(apvt_miss_model , data = miss_transform_data)
pairwise.t.test(miss_transform_data$Miss, miss_transform_data$Light_Settings, p.adj='bonferroni')


summary <-miss_transform_data %>% 
  group_by(Light_Settings) %>% 
  summarise(Mean=mean(Miss, na.rm = T),
            SEM = sd(Miss) / sqrt(n()))


```

```{r PVT-rt-anova-plot,include=FALSE}
metadata_pvt <- rt_data %>%
  mutate(Condition = factor(Light_Settings,
                               levels=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"
                                        )))


pvt_rt_plot <- metadata_pvt %>%
  ggplot(aes(x= Light_Settings, y = RT, fill = Light_Settings)) +
  # geom_boxplot(show.legend = FALSE)+
  stat_summary(fun.data = mean_se,  geom = "errorbar", width =0.5)+
  stat_summary(fun.data = mean_se, geom = "bar", show.legend = FALSE,width = .5, alpha=1)+
  # geom_jitter(show.legend=FALSE, width=0.25, shape=21, color="black") +
  labs(x=NULL,
       y="Reaction Time (ms)")+
  scale_x_discrete(breaks=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
                   labels=c(Low, Neutral, High))+
  scale_fill_manual(name=NULL,
                    breaks=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
                    labels=c(Low, Neutral, High),
                    values=c(Low_color, Neutral_color, High_color)) +
  apatheme +
  theme(axis.text.x = element_markdown())+
  scale_y_continuous(expand = expansion(mult = c(0, .1)))

# library(ggpubr)
# my_comparisons <- list( c("MELR 0.5_low", "MELR 0.7_neutral"), c("MELR 0.5_low", "MELR 1.0_high"), c("MELR 0.7_neutral", "MELR 1.0_high") )
# pvt_rt_plot+stat_compare_means(comparisons = my_comparisons)
# 

lines <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_lines = c(1,1,2),
  xend_lines = c(1.95,3,3),
  y_lines = c(600, 660, 600),
  yend_lines = y_lines
  
)


vlines_left <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_vlines_left = lines$x_lines,
  xend_vlines_left = lines$x_lines,
  y_vlines_left = lines$y_lines-5,
  yend_vlines_left = lines$y_lines
  
)

vlines_right <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_vlines_right  = lines$xend_lines,
  xend_vlines_right = lines$xend_lines,
  y_vlines_right = vlines_left$y_vlines_left,
  yend_vlines_right = lines$y_lines
  
)

stars <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  
  x = c(1.5,2, 2.5),
  
  y = c(630, 680, 630),
  label =c("n.s",  "*", "n.s")
)


anova_pvt_rt_plot <- pvt_rt_plot +
  geom_segment(data=lines, aes(x =x_lines, xend =xend_lines, y=y_lines, yend=yend_lines), inherit.aes = F)+
  geom_segment(data=vlines_left, aes(x =x_vlines_left, xend =xend_vlines_left, y=y_vlines_left, yend=yend_vlines_left), inherit.aes = F)+
  geom_segment(data=vlines_right, aes(x =x_vlines_right, xend =xend_vlines_right, y=y_vlines_right, yend=yend_vlines_right), inherit.aes = F)+
geom_text(data =stars, aes(x=x, y=y, label =label), inherit.aes = F,size = 5) 


# ggsave("Figures/anova_pvt_miss.png", width=4.5, height=3.5)

```

```{r PVT-miss-anova-plot,include=FALSE}
metadata_pvt <- miss_data %>%
  mutate(Condition = factor(Light_Settings,
                               levels=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"
                                        )))

metadata_pvt$Miss <- as.numeric(metadata_pvt$Miss)

pvt_miss_plot <- metadata_pvt %>%
  ggplot(aes(x= Light_Settings, y = Miss, fill = Light_Settings)) +
  # geom_boxplot(show.legend = FALSE)+
  stat_summary(fun.data = mean_se, geom = "errorbar", width =0.5)+
  stat_summary(fun.data = mean_se, geom = "bar", show.legend = FALSE,width = .5, alpha=1)+
  # geom_jitter(show.legend=FALSE, width=0.25, shape=21, color="black") +
  labs(x=NULL,
       y="PVT: Attention Lapses")+
  scale_x_discrete(breaks=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
                   labels=c(Low, Neutral, High))+
  scale_fill_manual(name=NULL,
                    breaks=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
                    labels=c(Low, Neutral, High),
                    values=c(Low_color, Neutral_color, High_color)) +
  apatheme +
  theme(axis.text.x = element_markdown())+
  scale_y_continuous(expand = expansion(mult = c(0, .1)))


lines <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_lines = c(1,1,2),
  xend_lines = c(1.95,3,3),
  y_lines = c(18, 20, 18),
  yend_lines = y_lines
  
)


vlines_left <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_vlines_left = lines$x_lines,
  xend_vlines_left = lines$x_lines,
  y_vlines_left = lines$y_lines-0.2,
  yend_vlines_left = lines$y_lines
  
)

vlines_right <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_vlines_right  = lines$xend_lines,
  xend_vlines_right = lines$xend_lines,
  y_vlines_right = vlines_left$y_vlines_left,
  yend_vlines_right = lines$y_lines
  
)

stars <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  
  x = c(1.5,2, 2.5),
  
  y = lines$y_lines+1,
  label =c("*",  "*", "n.s")
)


anova_pvt_miss_plot <- pvt_miss_plot  +
  geom_segment(data=lines, aes(x =x_lines, xend =xend_lines, y=y_lines, yend=yend_lines), inherit.aes = F)+
  geom_segment(data=vlines_left, aes(x =x_vlines_left, xend =xend_vlines_left, y=y_vlines_left, yend=yend_vlines_left), inherit.aes = F)+
  geom_segment(data=vlines_right, aes(x =x_vlines_right, xend =xend_vlines_right, y=y_vlines_right, yend=yend_vlines_right), inherit.aes = F)+
geom_text(data =stars, aes(x=x, y=y, label =label), inherit.aes = F,size = 5) 


# ggsave("Figures/anova_pvt_miss.png", width=4.5, height=3.5)

```


```{r alerting-plot, include =F}

alertness_plot <- cowplot::plot_grid(anova_kss_plot, anova_pvt_rt_plot ,anova_pvt_miss_plot,
                            
                   labels = "AUTO",
                   ncol=3,nrow=1,
                   label_size = 12,
                  align = "v",
                  label_fontfamily = "Arial",
                  label_fontface = "plain")
ggsave("Figures/Figure2.png",alertness_plot, width=10, height=3.5)




```

(ref:alert) Panel A-D depicts the one-way ANOVA results comparing the light conditions' effect on : (A) subjective sleepiness, (B) general reaction time, and (C) attention lapses and (D) 10% fastest reaction time. Each bar represents the mean ± standard error of measurements. 

```{r fig1, fig.align= 'center', fig.cap='(ref:alert)',  warning=FALSE,  out.height='100%', out.width='100%'}

knitr::include_graphics('Figures/alertness.png', dpi =300)

```

## Working Memory and Executive Functioning



```{r digitspan-anova}

digit_span<- data %>% 
  dplyr::select ("Light_Settings", "LDSF", "LSDB", "LDSS")

digit_span_2<- data %>% 
  dplyr::select ("Participant", "Light_Settings", "LDSF", "LSDB", "LDSS")

digit_span_forward<- data %>% 
  dplyr::select ("Light_Settings", "LDSF")


digit_span_backward<- data %>% 
  dplyr::select ("Light_Settings", "LSDB")


digit_span_sec<- data %>% 
  dplyr::select ("Light_Settings", "LDSS")




digit_span_summary <-digit_span %>% 
  group_by(Light_Settings) %>% 
  summarise(Mean_forward=mean(LDSF),
            SEM_forward = sd(LDSF) / sqrt(n()),
            Mean_backward=mean(LSDB),
            SEM_backward = sd(LSDB) / sqrt(n()),
            Mean_sequence=mean(LDSS),
            SEM_sequence = sd(LDSS) / sqrt(n()))




digit_span_long <- pivot_longer(digit_span_2,
                                cols= 3:5,
                                names_to = "block",
                                values_to = "Value")




# digit_span_forward_out <- outadj(digit_span_forward, digit_span_forward$LDSF)
# digit_span_backward_out <- outadj(digit_span_backward, digit_span_backward$LSDB)
# digit_span_sec_out <- outadj(digit_span_sec, digit_span_sec$LDSS)


library(rstatix)

dst_model <- digit_span_long%>%
  anova_test(dv = Value, wid = Participant, within = block, between = Light_Settings)

rstatix::get_anova_table(dst_model ,correction = ("auto"))

dst_tukey<- digit_span_long %>% 
  tukey_hsd(Value~block) 
dst_table <- rstatix::get_anova_table(dst_tukey)


digit_span_two_way <- aov(Value ~ Light_Settings*block, data = digit_span_long)
digit_span_two_way_summary <- summary(digit_span_two_way , data=digit_span_long)

digit_span_forward_aov <- aov(LDSF ~ Light_Settings, data = digit_span_forward )
digit_span_backward_aov <- aov(LSDB ~ Light_Settings, data = digit_span_backward)
digit_span_secq_aov <- aov(LDSS ~ Light_Settings, data = digit_span_sec)

digit_span_forward_summary <- summary(digit_span_forward_aov)
digit_span_backward_summary <- summary(digit_span_backward_aov)
digit_span_secq_summary <- summary(digit_span_secq_aov)


TukeyHSD(digit_span_forward_aov , data = digit_span_forward)



digit_span_forward_eff<- effectsize::effectsize(digit_span_forward_aov)
digit_span_backward_eff <- effectsize::effectsize(digit_span_backward_aov)
digit_span_secq_eff <- effectsize::effectsize(digit_span_secq_aov)


```

```{r forward-ds-plot,include=FALSE}
metadata_digit_span <- digit_span %>%
  mutate(Condition = factor(Light_Settings,
                               levels=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"
                                        )))


forward_plot <- metadata_digit_span %>%
  ggplot(aes(x= Light_Settings, y = LDSF, fill = Light_Settings)) +
  # geom_violin(trim=T)+ stat_summary(fun.data=mean_sdl, mult=1, 
  #                geom="crossbar", width=0.1, color="red")+
  stat_summary(fun.data = mean_se, geom = "errorbar", width =0.5)+
  stat_summary(fun.data = mean_se, geom = "bar", show.legend = FALSE,width = .5, alpha=1)+
  # geom_jitter(show.legend=FALSE, width=0.25, shape=21, color="black") +
  labs(x=NULL,
       y="Forward Digit Span")+
  scale_x_discrete(breaks=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
                   labels=c(Low, Neutral, High))+
  scale_fill_manual(name=NULL,
                    breaks=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
                    labels=c(Low, Neutral, High),
                    values=c(Low_color, Neutral_color, High_color)) +
  apatheme +
  theme(axis.text.x = element_markdown())+
  scale_y_continuous(expand = expansion(mult = c(0, .1)))


lines <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_lines = c(1,1,2),
  xend_lines = c(1.95,3,3),
  y_lines = c(10, 11, 10),
  yend_lines = y_lines
  
)


vlines_left <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_vlines_left = lines$x_lines,
  xend_vlines_left = lines$x_lines,
  y_vlines_left = lines$y_lines-0.3,
  yend_vlines_left = lines$y_lines
  
)

vlines_right <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_vlines_right  = lines$xend_lines,
  xend_vlines_right = lines$xend_lines,
  y_vlines_right = vlines_left$y_vlines_left,
  yend_vlines_right = lines$y_lines
  
)

stars <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  
  x = c(1.5,2, 2.5),
  
  y = lines$y_lines+.5,
  label =c("p=0.09",  "n.s", "n.s")
)


anova_forward_plot <-forward_plot +
  geom_segment(data=lines, aes(x =x_lines, xend =xend_lines, y=y_lines, yend=yend_lines), inherit.aes = F)+
  geom_segment(data=vlines_left, aes(x =x_vlines_left, xend =xend_vlines_left, y=y_vlines_left, yend=yend_vlines_left), inherit.aes = F)+
  geom_segment(data=vlines_right, aes(x =x_vlines_right, xend =xend_vlines_right, y=y_vlines_right, yend=yend_vlines_right), inherit.aes = F)+
geom_text(data =stars, aes(x=x, y=y, label =label), inherit.aes = F,size = 5) 

# ggsave("Figures/Figure7.png", width=9, height=7)

# ggsave("Figures/anova_pvt_miss.png", width=4.5, height=3.5)

```

```{r backward-ds-plot,include=FALSE}
metadata_digit_span <- digit_span %>%
  mutate(Condition = factor(Light_Settings,
                               levels=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"
                                        )))



backward_plot <- metadata_digit_span %>%
  ggplot(aes(x= Light_Settings, y = LSDB, fill = Light_Settings)) +
  # geom_violin(trim=T)+ stat_summary(fun.data=mean_sdl, mult=1, 
  #                geom="crossbar", width=0.1, color="red")+
  stat_summary(fun.data = mean_se, geom = "errorbar", width =0.5)+
  stat_summary(fun.data = mean_se, geom = "bar", show.legend = FALSE,width = .5, alpha=1)+
  # geom_jitter(show.legend=FALSE, width=0.25, shape=21, color="black") +
  labs(x=NULL,
       y="Backward Digit Span")+
  scale_x_discrete(breaks=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
                   labels=c(Low, Neutral, High))+
  scale_fill_manual(name=NULL,
                    breaks=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
                    labels=c(Low, Neutral, High),
                    values=c(Low_color, Neutral_color, High_color)) +
  apatheme +
  theme(axis.text.x = element_markdown())+
  scale_y_continuous(expand = expansion(mult = c(0, .1)))


lines <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_lines = c(1,1,2),
  xend_lines = c(1.95,3,3),
  y_lines = c(10, 11, 10),
  yend_lines = y_lines
  
)


vlines_left <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_vlines_left = lines$x_lines,
  xend_vlines_left = lines$x_lines,
  y_vlines_left = lines$y_lines-0.3,
  yend_vlines_left = lines$y_lines
  
)

vlines_right <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_vlines_right  = lines$xend_lines,
  xend_vlines_right = lines$xend_lines,
  y_vlines_right = vlines_left$y_vlines_left,
  yend_vlines_right = lines$y_lines
  
)

stars <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  
  x = c(1.5,2, 2.5),
  
  y = lines$y_lines+.5,
  label =c("n.s",  "n.s", "n.s")
)


anova_backward_plot <-backward_plot +
  geom_segment(data=lines, aes(x =x_lines, xend =xend_lines, y=y_lines, yend=yend_lines), inherit.aes = F)+
  geom_segment(data=vlines_left, aes(x =x_vlines_left, xend =xend_vlines_left, y=y_vlines_left, yend=yend_vlines_left), inherit.aes = F)+
  geom_segment(data=vlines_right, aes(x =x_vlines_right, xend =xend_vlines_right, y=y_vlines_right, yend=yend_vlines_right), inherit.aes = F)+
geom_text(data =stars, aes(x=x, y=y, label =label), inherit.aes = F,size = 5) 

# ggsave("Figures/Figure7.png", width=9, height=7)

# ggsave("Figures/anova_pvt_miss.png", width=4.5, height=3.5)

```

```{r sequential-ds-plot,include=FALSE}
metadata_digit_span <- digit_span %>%
  mutate(Condition = factor(Light_Settings,
                               levels=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"
                                        )))



sequential_plot <- metadata_digit_span %>%
  ggplot(aes(x= Light_Settings, y = LDSS, fill = Light_Settings)) +
  # geom_violin(trim=T)+ stat_summary(fun.data=mean_sdl, mult=1, 
  #                geom="crossbar", width=0.1, color="red")+
  stat_summary(fun.data = mean_se, geom = "errorbar", width =0.5)+
  stat_summary(fun.data = mean_se, geom = "bar", show.legend = FALSE,width = .5, alpha=1)+
  # geom_jitter(show.legend=FALSE, width=0.25, shape=21, color="black") +
  labs(x=NULL,
       y="Sequential Digit Span")+
  scale_x_discrete(breaks=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
                   labels=c(Low, Neutral, High))+
  scale_fill_manual(name=NULL,
                    breaks=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
                    labels=c(Low, Neutral, High),
                    values=c(Low_color, Neutral_color, High_color)) +
  apatheme +
  theme(axis.text.x = element_markdown())+
  scale_y_continuous(expand = expansion(mult = c(0, .1)))


lines <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_lines = c(1,1,2),
  xend_lines = c(1.95,3,3),
  y_lines = c(10, 11, 10),
  yend_lines = y_lines
  
)


vlines_left <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_vlines_left = lines$x_lines,
  xend_vlines_left = lines$x_lines,
  y_vlines_left = lines$y_lines-0.3,
  yend_vlines_left = lines$y_lines
  
)

vlines_right <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_vlines_right  = lines$xend_lines,
  xend_vlines_right = lines$xend_lines,
  y_vlines_right = vlines_left$y_vlines_left,
  yend_vlines_right = lines$y_lines
  
)

stars <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  
  x = c(1.5,2, 2.5),
  
  y = lines$y_lines+.5,
  label =c("n.s",  "n.s", "n.s")
)


anova_sequential_plot <-sequential_plot +
  geom_segment(data=lines, aes(x =x_lines, xend =xend_lines, y=y_lines, yend=yend_lines), inherit.aes = F)+
  geom_segment(data=vlines_left, aes(x =x_vlines_left, xend =xend_vlines_left, y=y_vlines_left, yend=yend_vlines_left), inherit.aes = F)+
  geom_segment(data=vlines_right, aes(x =x_vlines_right, xend =xend_vlines_right, y=y_vlines_right, yend=yend_vlines_right), inherit.aes = F)+
geom_text(data =stars, aes(x=x, y=y, label =label), inherit.aes = F,size = 5) 

# ggsave("Figures/Figure7.png", width=9, height=7)

# ggsave("Figures/anova_pvt_miss.png", width=4.5, height=3.5)

```


```{r nback-anova}
#Subseting N-back data
nback_data<- data %>% 
  dplyr::select (Participant, Light_Settings, One_back_GA:Three_back_rt, One_back_HR, One_back_FalseAlarm, One_back_d, One_back_c,Three_back_HR, Three_back_FA, Three_back_d,Three_back_c)






#One way anova: one-back 

oneback_acc_model <- aov(One_back_GA ~ Light_Settings, data = nback_data)
oneback_acc_model_summary <- summary(oneback_acc_model)


oneback_rt_model <- aov(1/One_back_rt ~ Light_Settings, data = nback_data)
oneback_rt_model_summary <- summary(oneback_rt_model)
##One way anova: two-back

twoback_acc_model <- aov(Three_back_GA ~ Light_Settings, data = nback_data)
twoback_acc_model_summary <- summary(twoback_acc_model )

twoback_rt_model <- aov(1/Three_back_rt ~ Light_Settings, data = nback_data)
twoback_rt_model_summary <- summary(twoback_rt_model )
TukeyHSD(twoback_rt_model, data=nback_data)



# Preparing data for twoway anova

nback_data_rt <- nback_data %>% 
  dplyr::select(Participant, Light_Settings,One_back_rt,Three_back_rt  )

nback_data_acc <- nback_data %>% 
  dplyr::select(Participant, Light_Settings,One_back_GA,Three_back_GA  )

nback_data_hr <- nback_data %>% 
  dplyr::select(Participant, Light_Settings,One_back_HR,Three_back_HR  )


nback_data_fa <- nback_data %>% 
  dplyr::select(Participant, Light_Settings,One_back_FalseAlarm,Three_back_FA  )

nback_data_d<- nback_data %>% 
  dplyr::select(Participant, Light_Settings,One_back_d,Three_back_d )

nback_data_c <- nback_data %>% 
  dplyr::select(Participant, Light_Settings,One_back_c,Three_back_c  )





## Long data frame  for twoway anova
nback_data_rt_long <- pivot_longer(nback_data_rt,
                                   cols = 3:4,
                                   names_to = "block",
                                   values_to= "Value")

nback_data_acc_long <- pivot_longer(nback_data_acc,
                                   cols = 3:4,
                                   names_to = "block",
                                   values_to= "Value")


nback_data_hr_long <- pivot_longer(nback_data_hr,
                                   cols = 3:4,
                                   names_to = "block",
                                   values_to= "Value")



nback_data_fa_long <- pivot_longer(nback_data_fa,
                                   cols = 3:4,
                                   names_to = "block",
                                   values_to= "Value")


nback_data_d_long <- pivot_longer(nback_data_d,
                                   cols = 3:4,
                                   names_to = "block",
                                   values_to= "Value")

nback_data_c_long <- pivot_longer(nback_data_c,
                                   cols = 3:4,
                                   names_to = "block",
                                   values_to= "Value")


nback_data_rt_summary_interaction <-nback_data_rt_long %>% 
  group_by(Light_Settings, block) %>% 
  summarise(Mean=mean(Value*1000,na.rm=TRUE),
            SEM = sd(Value*1000,na.rm=TRUE) / sqrt(n()) )

nback_data_rt_summary_main_effect <-nback_data_rt_long %>% 
  group_by(Light_Settings) %>% 
  summarise(Mean=mean(Value*1000,na.rm=TRUE),
            SEM = sd(Value*1000,na.rm=TRUE) / sqrt(n()) )

nback_data_rt_summary_task <-nback_data_rt_long %>% 
  group_by(block) %>% 
  summarise(Mean=mean(Value*1000,na.rm=TRUE),
            SEM = sd(Value*1000,na.rm=TRUE) / sqrt(n()) )


nback_data_acc_summary_main_effect <-nback_data_acc_long %>% 
  group_by(Light_Settings) %>% 
  summarise(Mean=mean(Value*100,na.rm=TRUE),
            SEM = sd(Value*100,na.rm=TRUE) / sqrt(n()) )

nback_data_acc_summary_interaction <-nback_data_acc_long %>% 
  group_by(Light_Settings, block) %>% 
  summarise(Mean=mean(Value*100,na.rm=TRUE),
            SEM = sd(Value*100,na.rm=TRUE) / sqrt(n()) )

nback_data_acc_summary_task <-nback_data_acc_long %>% 
  group_by(block) %>% 
  summarise(Mean=mean(Value*100,na.rm=TRUE),
            SEM = sd(Value*100,na.rm=TRUE) / sqrt(n()) )


nback_data_hr_summary_main_effect <-nback_data_hr_long %>% 
  group_by(Light_Settings) %>% 
  summarise(Mean=mean(Value,na.rm=TRUE),
            SEM = sd(Value,na.rm=TRUE) / sqrt(n()) )

nback_data_hr_summary_interaction <-nback_data_hr_long %>% 
  group_by(Light_Settings, block) %>% 
  summarise(Mean=mean(Value,na.rm=TRUE),
            SEM = sd(Value,na.rm=TRUE) / sqrt(n()) )

nback_data_hr_summary_task <-nback_data_hr_long %>% 
  group_by(block) %>% 
  summarise(Mean=mean(Value,na.rm=TRUE),
            SEM = sd(Value,na.rm=TRUE) / sqrt(n()) )


nback_data_fa_summary_main_effect <-nback_data_fa_long %>% 
  group_by(Light_Settings) %>% 
  summarise(Mean=mean(Value,na.rm=TRUE),
            SEM = sd(Value,na.rm=TRUE) / sqrt(n()) )



nback_data_fa_summary_interaction <-nback_data_fa_long %>% 
  group_by(Light_Settings, block) %>% 
  summarise(Mean=mean(Value,na.rm=TRUE),
            SEM = sd(Value,na.rm=TRUE) / sqrt(n()) )


nback_data_fa_summary_task <-nback_data_fa_long %>% 
  group_by(block) %>% 
  summarise(Mean=mean(Value,na.rm=TRUE),
            SEM = sd(Value,na.rm=TRUE) / sqrt(n()) )


nback_data_d_summary_main_effect <-nback_data_d_long %>% 
  group_by(Light_Settings) %>% 
  summarise(Mean=mean(Value,na.rm=TRUE),
            SEM = sd(Value,na.rm=TRUE) / sqrt(n()) )

nback_data_d_summary_interaction <-nback_data_d_long %>% 
  group_by(Light_Settings, block) %>% 
  summarise(Mean=mean(Value,na.rm=TRUE),
            SEM = sd(Value,na.rm=TRUE) / sqrt(n()) )

nback_data_d_summary_task <-nback_data_d_long %>% 
  group_by(block) %>% 
  summarise(Mean=mean(Value,na.rm=TRUE),
            SEM = sd(Value,na.rm=TRUE) / sqrt(n()) )



nback_data_c_summary_main_effect <-nback_data_c_long %>% 
  group_by(Light_Settings) %>% 
  summarise(Mean=mean(Value,na.rm=TRUE),
            SEM = sd(Value,na.rm=TRUE) / sqrt(n()) )

nback_data_c_summary_interaction <-nback_data_c_long %>% 
  group_by(Light_Settings, block) %>% 
  summarise(Mean=mean(Value,na.rm=TRUE),
            SEM = sd(Value,na.rm=TRUE) / sqrt(n()) )

nback_data_c_summary_task <-nback_data_c_long %>% 
  group_by(block) %>% 
  summarise(Mean=mean(Value,na.rm=TRUE),
            SEM = sd(Value,na.rm=TRUE) / sqrt(n()) )




## two-way anova models
nback_data_rt_long[17,4] <- 1

# nhr_summary <- nhr %>% 
#   dplyr::group_by(Condition) %>% 
#   get_summary_stats(HR, type ="mean_se")
  
library(rstatix)
nback_data_rt_long$Speed <- 1/nback_data_rt_long$Value

rt_model <- nback_data_rt_long%>%
  anova_test(dv = Speed, wid = Participant, within = c(block), between = Light_Settings)

rstatix::get_anova_table(rt_model ,correction = c("auto"))

nrt_tukey<- nback_data_rt_long %>% 
  tukey_hsd(Speed~Light_Settings) 
P_table <- rstatix::get_anova_table(nrt_tukey)


# 
# rt_model <- aov(1/Value ~ Light_Settings*block, data = nback_data_rt_long,id=Participant)
# effectsize::effectsize(rt_model )
# 
# 
# rt_model_summary <- summary(rt_model)
# TukeyHSD(rt_model, data = nback_data_rt_long)




acc_model <- nback_data_acc_long%>%
  anova_test(dv = Value , wid = Participant, within = c(block), between = Light_Settings)

rstatix::get_anova_table(acc_model ,correction = c("auto"))



hr_model <- nback_data_hr_long %>% 
  anova_test(dv = Value , wid = Participant, within = c(block), between = Light_Settings)

rstatix::get_anova_table(hr_model ,correction = c("auto"))




fa_model <- nback_data_fa_long %>% 
  anova_test(dv = Value , wid = Participant, within = c(block), between = Light_Settings)

rstatix::get_anova_table(fa_model ,correction = c("auto"))


d_model  <- nback_data_d_long %>% 
  anova_test(dv = Value , wid = Participant, within = c(block), between = Light_Settings)

rstatix::get_anova_table(d_model  ,correction = c("auto"))

c_model  <- nback_data_c_long %>% 
  anova_test(dv = Value , wid = Participant, within = c(block), between = Light_Settings)

rstatix::get_anova_table(c_model  ,correction = c("auto"))






```

```{r Nbackrt,include=FALSE}
metadata_rt <- nback_data_rt_long %>%
  mutate(Condition = factor(Light_Settings,
                               levels=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"
                                        )))

metadata_rt$Value2 <- metadata_rt$Value*1000

n_back_rt_plot <- metadata_rt %>%
  ggplot(aes(x= Light_Settings, y = Value2, fill = Light_Settings)) +
  # geom_violin(trim=T)+ stat_summary(fun.data=mean_sdl, mult=1, 
  #                geom="crossbar", width=0.1, color="red")+
  stat_summary(fun.data = mean_se, geom = "errorbar", width =0.5)+
  stat_summary(fun.data = mean_se, geom = "bar", show.legend = FALSE,width = .5, alpha=1)+
  # geom_jitter(show.legend=FALSE, width=0.25, shape=21, color="black") +
  labs(x=NULL,
       y="N Back: Reaction Time (ms)")+
  scale_x_discrete(breaks=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
                   labels=c(Low, Neutral, High))+
  scale_fill_manual(name=NULL,
                    breaks=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
                    labels=c(Low, Neutral, High),
                    values=c(Low_color, Neutral_color, High_color)) +
  apatheme +
  theme(axis.text.x = element_markdown())+
  scale_y_continuous(expand = expansion(mult = c(0, .1)))


lines <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_lines = c(1,1,2),
  xend_lines = c(1.95,3,3),
  y_lines = c(1200, 1300, 1200),
  yend_lines = y_lines
  
)


vlines_left <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_vlines_left = lines$x_lines,
  xend_vlines_left = lines$x_lines,
  y_vlines_left = lines$y_lines-25,
  yend_vlines_left = lines$y_lines
  
)

vlines_right <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_vlines_right  = lines$xend_lines,
  xend_vlines_right = lines$xend_lines,
  y_vlines_right = vlines_left$y_vlines_left,
  yend_vlines_right = lines$y_lines
  
)

stars <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  
  x = c(1.5,2, 2.5),
  
  y = lines$y_lines+50,
  label =c("n.s",  "n.s", "n.s")
)


anova_n_back_rt_plot <-n_back_rt_plot +
  geom_segment(data=lines, aes(x =x_lines, xend =xend_lines, y=y_lines, yend=yend_lines), inherit.aes = F)+
  geom_segment(data=vlines_left, aes(x =x_vlines_left, xend =xend_vlines_left, y=y_vlines_left, yend=yend_vlines_left), inherit.aes = F)+
  geom_segment(data=vlines_right, aes(x =x_vlines_right, xend =xend_vlines_right, y=y_vlines_right, yend=yend_vlines_right), inherit.aes = F)+
geom_text(data =stars, aes(x=x, y=y, label =label), inherit.aes = F,size = 5) 

# ggsave("Figures/Figure7.png", width=9, height=7)

# ggsave("Figures/anova_pvt_miss.png", width=4.5, height=3.5)

```

```{r Nbackacc,include=FALSE}
metadata_acc <- nback_data_acc_long %>%
  mutate(Condition = factor(Light_Settings,
                               levels=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"
                                        )))

metadata_acc$Value2 <- metadata_acc$Value*100

n_back_acc_plot <- metadata_acc %>%
  ggplot(aes(x= Light_Settings, y = Value2, fill = Light_Settings)) +
  # geom_violin(trim=T)+ stat_summary(fun.data=mean_sdl, mult=1, 
  #                geom="crossbar", width=0.1, color="red")+
  stat_summary(fun.data = mean_se, geom = "errorbar", width =0.5)+
  stat_summary(fun.data = mean_se, geom = "bar", show.legend = FALSE,width = .5, alpha=1)+
  # geom_jitter(show.legend=FALSE, width=0.25, shape=21, color="black") +
  labs(x=NULL,
       y="N Back: Accuracy (%)")+
  scale_x_discrete(breaks=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
                   labels=c(Low, Neutral, High))+
  scale_fill_manual(name=NULL,
                    breaks=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
                    labels=c(Low, Neutral, High),
                    values=c(Low_color, Neutral_color, High_color)) +
  apatheme +
  theme(axis.text.x = element_markdown())+
  scale_y_continuous(expand = expansion(mult = c(0, .1)), breaks = c(0,25,50,75,100))



lines <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_lines = c(1,1,2),
  xend_lines = c(1.95,3,3),
  y_lines = c(103, 115, 103),
  yend_lines = y_lines
  
)


vlines_left <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_vlines_left = lines$x_lines,
  xend_vlines_left = lines$x_lines,
  y_vlines_left = lines$y_lines-2,
  yend_vlines_left = lines$y_lines
  
)

vlines_right <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_vlines_right  = lines$xend_lines,
  xend_vlines_right = lines$xend_lines,
  y_vlines_right = vlines_left$y_vlines_left,
  yend_vlines_right = lines$y_lines
  
)

stars <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  
  x = c(1.5,2, 2.5),
  
  y = lines$y_lines+5,
  label =c("n.s",  "n.s", "n.s")
)


anova_n_back_acc_plot <-n_back_acc_plot +
  geom_segment(data=lines, aes(x =x_lines, xend =xend_lines, y=y_lines, yend=yend_lines), inherit.aes = F)+
  geom_segment(data=vlines_left, aes(x =x_vlines_left, xend =xend_vlines_left, y=y_vlines_left, yend=yend_vlines_left), inherit.aes = F)+
  geom_segment(data=vlines_right, aes(x =x_vlines_right, xend =xend_vlines_right, y=y_vlines_right, yend=yend_vlines_right), inherit.aes = F)+
geom_text(data =stars, aes(x=x, y=y, label =label), inherit.aes = F,size = 5) 

# ggsave("Figures/Figure7.png", width=9, height=7)

# ggsave("Figures/anova_pvt_miss.png", width=4.5, height=3.5)

```

```{r Nbackhr,include=FALSE}
metadata_hr <- nback_data_hr_long %>%
  mutate(Condition = factor(Light_Settings,
                               levels=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"
                                        )))



n_back_hr_plot <- metadata_hr %>%
  ggplot(aes(x= Light_Settings, y = Value, fill = Light_Settings)) +
  # geom_violin(trim=T)+ stat_summary(fun.data=mean_sdl, mult=1, 
  #                geom="crossbar", width=0.1, color="red")+
  stat_summary(fun.data = mean_se, geom = "errorbar", width =0.5)+
  stat_summary(fun.data = mean_se, geom = "bar", show.legend = FALSE,width = .5, alpha=1)+
  # geom_jitter(show.legend=FALSE, width=0.25, shape=21, color="black") +
  labs(x=NULL,
       y="N Back: Hit Ratio")+
  scale_x_discrete(breaks=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
                   labels=c(Low, Neutral, High))+
  scale_fill_manual(name=NULL,
                    breaks=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
                    labels=c(Low, Neutral, High),
                    values=c(Low_color, Neutral_color, High_color)) +
  apatheme +
  theme(axis.text.x = element_markdown())+
  scale_y_continuous(expand = expansion(mult = c(0, .1)), breaks = c(0,0.25,.50,0.75,1))


lines <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_lines = c(1,1,2),
  xend_lines = c(1.95,3,3),
  y_lines = c(1, 1.1, 1),
  yend_lines = y_lines
  
)


vlines_left <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_vlines_left = lines$x_lines,
  xend_vlines_left = lines$x_lines,
  y_vlines_left = lines$y_lines-.02,
  yend_vlines_left = lines$y_lines
  
)

vlines_right <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_vlines_right  = lines$xend_lines,
  xend_vlines_right = lines$xend_lines,
  y_vlines_right = vlines_left$y_vlines_left,
  yend_vlines_right = lines$y_lines
  
)

stars <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  
  x = c(1.5,2, 2.5),
  
  y = lines$y_lines+.05,
  label =c("n.s",  "n.s", "n.s")
)


anova_n_back_hr_plot <-n_back_hr_plot +
  geom_segment(data=lines, aes(x =x_lines, xend =xend_lines, y=y_lines, yend=yend_lines), inherit.aes = F)+
  geom_segment(data=vlines_left, aes(x =x_vlines_left, xend =xend_vlines_left, y=y_vlines_left, yend=yend_vlines_left), inherit.aes = F)+
  geom_segment(data=vlines_right, aes(x =x_vlines_right, xend =xend_vlines_right, y=y_vlines_right, yend=yend_vlines_right), inherit.aes = F)+
geom_text(data =stars, aes(x=x, y=y, label =label), inherit.aes = F,size = 5) 

# ggsave("Figures/Figure7.png", width=9, height=7)

# ggsave("Figures/anova_pvt_miss.png", width=4.5, height=3.5)

```

```{r Nbackfa,include=FALSE}
metadata_fa <- nback_data_fa_long %>%
  mutate(Condition = factor(Light_Settings,
                               levels=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"
                                        )))



n_back_fa_plot <- metadata_fa %>%
  ggplot(aes(x= Light_Settings, y = Value, fill = Light_Settings)) +
  # geom_violin(trim=T)+ stat_summary(fun.data=mean_sdl, mult=1, 
  #                geom="crossbar", width=0.1, color="red")+
  stat_summary(fun.data = mean_se, geom = "errorbar", width =0.5)+
  stat_summary(fun.data = mean_se, geom = "bar", show.legend = FALSE,width = .5, alpha=1)+
  # geom_jitter(show.legend=FALSE, width=0.25, shape=21, color="black") +
  labs(x=NULL,
       y="N Back: False Alarm")+
  scale_x_discrete(breaks=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
                   labels=c(Low, Neutral, High))+
  scale_fill_manual(name=NULL,
                    breaks=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
                    labels=c(Low, Neutral, High),
                    values=c(Low_color, Neutral_color, High_color)) +
  apatheme +
  theme(axis.text.x = element_markdown())+
  scale_y_continuous(expand = expansion(mult = c(0, .1)), breaks= c(0,.25,.50,.75,1))


lines <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_lines = c(1,1,2),
  xend_lines = c(1.95,3,3),
  y_lines = c(1, 1.1, 1),
  yend_lines = y_lines
  
)


vlines_left <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_vlines_left = lines$x_lines,
  xend_vlines_left = lines$x_lines,
  y_vlines_left = lines$y_lines-.01,
  yend_vlines_left = lines$y_lines
  
)

vlines_right <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_vlines_right  = lines$xend_lines,
  xend_vlines_right = lines$xend_lines,
  y_vlines_right = vlines_left$y_vlines_left,
  yend_vlines_right = lines$y_lines
  
)

stars <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  
  x = c(1.5,2, 2.5),
  
  y = lines$y_lines+.05,
  label =c("n.s",  "n.s", "n.s")
)


anova_n_back_fa_plot <-n_back_fa_plot +
  geom_segment(data=lines, aes(x =x_lines, xend =xend_lines, y=y_lines, yend=yend_lines), inherit.aes = F)+
  geom_segment(data=vlines_left, aes(x =x_vlines_left, xend =xend_vlines_left, y=y_vlines_left, yend=yend_vlines_left), inherit.aes = F)+
  geom_segment(data=vlines_right, aes(x =x_vlines_right, xend =xend_vlines_right, y=y_vlines_right, yend=yend_vlines_right), inherit.aes = F)+
geom_text(data =stars, aes(x=x, y=y, label =label), inherit.aes = F,size = 5) 

# ggsave("Figures/Figure7.png", width=9, height=7)

# ggsave("Figures/anova_pvt_miss.png", width=4.5, height=3.5)

```

```{r Nbackd,include=FALSE}
metadata_d <- nback_data_d_long %>%
  mutate(Condition = factor(Light_Settings,
                               levels=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"
                                        )))



n_back_d_plot <- metadata_d %>%
  ggplot(aes(x= Light_Settings, y = Value, fill = Light_Settings)) +
  # geom_violin(trim=T)+ stat_summary(fun.data=mean_sdl, mult=1, 
  #                geom="crossbar", width=0.1, color="red")+
  stat_summary(fun.data = mean_se, geom = "errorbar", width =0.5)+
  stat_summary(fun.data = mean_se, geom = "bar", show.legend = FALSE,width = .5, alpha=1)+
  # geom_jitter(show.legend=FALSE, width=0.25, shape=21, color="black") +
  labs(x=NULL,
       y="N Back: Sensitivity")+
  scale_x_discrete(breaks=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
                   labels=c(Low, Neutral, High))+
  scale_fill_manual(name=NULL,
                    breaks=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
                    labels=c(Low, Neutral, High),
                    values=c(Low_color, Neutral_color, High_color)) +
  apatheme +
  theme(axis.text.x = element_markdown())+
  scale_y_continuous(expand = expansion(mult = c(0, .1)))


lines <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_lines = c(1,1,2),
  xend_lines = c(1.95,3,3),
  y_lines = c(3, 3.5, 3),
  yend_lines = y_lines
  
)


vlines_left <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_vlines_left = lines$x_lines,
  xend_vlines_left = lines$x_lines,
  y_vlines_left = lines$y_lines-.1,
  yend_vlines_left = lines$y_lines
  
)

vlines_right <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_vlines_right  = lines$xend_lines,
  xend_vlines_right = lines$xend_lines,
  y_vlines_right = vlines_left$y_vlines_left,
  yend_vlines_right = lines$y_lines
  
)

stars <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  
  x = c(1.5,2, 2.5),
  
  y = lines$y_lines+.3,
  label =c("n.s",  "n.s", "n.s")
)


anova_n_back_d_plot <-n_back_d_plot +
  geom_segment(data=lines, aes(x =x_lines, xend =xend_lines, y=y_lines, yend=yend_lines), inherit.aes = F)+
  geom_segment(data=vlines_left, aes(x =x_vlines_left, xend =xend_vlines_left, y=y_vlines_left, yend=yend_vlines_left), inherit.aes = F)+
  geom_segment(data=vlines_right, aes(x =x_vlines_right, xend =xend_vlines_right, y=y_vlines_right, yend=yend_vlines_right), inherit.aes = F)+
geom_text(data =stars, aes(x=x, y=y, label =label), inherit.aes = F,size = 5) 

# ggsave("Figures/Figure7.png", width=9, height=7)

# ggsave("Figures/anova_pvt_miss.png", width=4.5, height=3.5)

```

```{r Nbackhc,include=FALSE}
metadata_c <- nback_data_c_long %>%
  mutate(Condition = factor(Light_Settings,
                               levels=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"
                                        )))



n_back_c_plot <- metadata_c %>%
  ggplot(aes(x= Light_Settings, y = Value, fill = Light_Settings)) +
  # geom_violin(trim=T)+ stat_summary(fun.data=mean_sdl, mult=1, 
  #                geom="crossbar", width=0.1, color="red")+
  stat_summary(fun.data = mean_se, geom = "errorbar", width =0.5)+
  stat_summary(fun.data = mean_se, geom = "bar", show.legend = FALSE,width = .5, alpha=1)+
  # geom_jitter(show.legend=FALSE, width=0.25, shape=21, color="black") +
  labs(x=NULL,
       y="N Back: Bias")+
  scale_x_discrete(breaks=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
                   labels=c(Low, Neutral, High))+
  scale_fill_manual(name=NULL,
                    breaks=c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
                    labels=c(Low, Neutral, High),
                    values=c(Low_color, Neutral_color, High_color)) +
  apatheme +
  theme(axis.text.x = element_markdown())+
  scale_y_continuous(expand = expansion(mult = c(0, .1)), breaks = c(0,.25,.50,.75,1))


lines <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_lines = c(1,1,2),
  xend_lines = c(1.95,3,3),
  y_lines = c(1, 1.1, 1),
  yend_lines = y_lines
  
)


vlines_left <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_vlines_left = lines$x_lines,
  xend_vlines_left = lines$x_lines,
  y_vlines_left = lines$y_lines-.02,
  yend_vlines_left = lines$y_lines
  
)

vlines_right <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  x_vlines_right  = lines$xend_lines,
  xend_vlines_right = lines$xend_lines,
  y_vlines_right = vlines_left$y_vlines_left,
  yend_vlines_right = lines$y_lines
  
)

stars <- tibble(
  Condition = factor(c("MELR 0.5_low","MELR 0.7_neutral","MELR 1.0_high"),
             levels = c(Low, Neutral, High)),
  
  x = c(1.5,2, 2.5),
  
  y = lines$y_lines+.05,
  label =c("n.s",  "*", "n.s")
)


anova_n_back_c_plot <-n_back_c_plot +
  geom_segment(data=lines, aes(x =x_lines, xend =xend_lines, y=y_lines, yend=yend_lines), inherit.aes = F)+
  geom_segment(data=vlines_left, aes(x =x_vlines_left, xend =xend_vlines_left, y=y_vlines_left, yend=yend_vlines_left), inherit.aes = F)+
  geom_segment(data=vlines_right, aes(x =x_vlines_right, xend =xend_vlines_right, y=y_vlines_right, yend=yend_vlines_right), inherit.aes = F)+
geom_text(data =stars, aes(x=x, y=y, label =label), inherit.aes = F,size = 5) 

# ggsave("Figures/Figure7.png", width=9, height=7)

# ggsave("Figures/anova_pvt_miss.png", width=4.5, height=3.5)

```


```{r executive-function, include =F}

digit_span_plot <- cowplot::plot_grid(anova_forward_plot,anova_backward_plot, anova_sequential_plot,
                            
                   labels = "AUTO",
                   ncol=3,nrow=1,
                   label_size = 12,
                  align = "v",
                  label_fontfamily = "Arial",
                  label_fontface = "plain")
ggsave("Figures/Figure3.png",digit_span_plot, width=10, height=3.5)


ef_plot <- cowplot::plot_grid(anova_n_back_rt_plot, anova_n_back_acc_plot,anova_n_back_hr_plot,anova_n_back_fa_plot,
                            
                   labels = "AUTO",
                   ncol=2,nrow=2,
                   label_size = 14,
                  align = "v",
                  label_fontfamily = "Arial",
                  label_fontface = "plain")
ggsave("Figures/Figure4.png",ef_plot, width=10, height=7)




```

(ref:ef)  light conditions' effect on : (A) forward digit span, (B) backward digit span, (C) sequential digit span (D) Tol: execution time (E) Tol: efficacy (F) Tol: planning time (G) reaction time in N-back (H) accuracy in N back. Each bar represents the mean ± standard error of measurements. 

```{r fig2, fig.align= 'center', fig.cap='(ref:ef)',  warning=FALSE,  out.height='100%', out.width='100%'}

knitr::include_graphics('Figures/executive_functions.png', dpi =300)

```



# Discussion

\newpage

# References

```{=tex}
\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}
```
::: {#refs custom-style="Bibliography"}
:::

```{=tex}
\endgroup
```
